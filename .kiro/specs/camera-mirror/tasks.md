# 実装計画

- [x] 1. プロジェクト構造とコアインターフェースのセットアップ
  - lib/配下にディレクトリ構造を作成（models, services, screens, widgets）
  - CameraStateとCameraErrorの列挙型とモデルを定義
  - テストフレームワークのセットアップ
  - _要件: 1.1, 1.2, 1.3, 1.4_

- [x] 2. CameraServiceの実装
  - [x] 2.1 CameraServiceクラスの基本構造を作成
    - dart:htmlを使用してMediaStream APIにアクセスするメソッドを実装
    - VideoElementの作成と管理機能を実装
    - カメラストリームの初期化ロジックを実装
    - _要件: 1.2_

  - [x] 2.2 プロパティテスト: カメラ初期化後のストリーム開始
    - **プロパティ 1: カメラ初期化後のストリーム開始**
    - **検証対象: 要件 1.2**

  - [x] 2.3 リソース解放機能の実装
    - disposeメソッドを実装してストリームとVideoElementを適切に破棄
    - _要件: 4.1, 4.2_

  - [x] 2.4 プロパティテスト: リソースの適切な解放
    - **プロパティ 5: リソースの適切な解放**
    - **検証対象: 要件 4.1, 4.2**

  - [x] 2.5 エラーハンドリングの実装
    - カメラ利用不可、権限拒否、ストリームエラーの各ケースを処理
    - CameraErrorモデルを使用してエラー情報を構造化
    - _要件: 1.3, 1.4, 5.1, 5.3_

  - [x] 2.6 プロパティテスト: エラー時のメッセージ表示
    - **プロパティ 6: エラー時のメッセージ表示**
    - **検証対象: 要件 5.1**

  - [x] 2.7 プロパティテスト: エラーのロギング
    - **プロパティ 8: エラーのロギング**
    - **検証対象: 要件 5.3**

  - [x] 2.8 ストリーム中断時の再接続機能を実装
    - 自動再接続ロジック（最大3回）を実装
    - 再接続状態の通知機能を実装
    - _要件: 5.2_

  - [x] 2.9 プロパティテスト: ストリーム中断時の再接続試行
    - **プロパティ 7: ストリーム中断時の再接続試行**
    - **検証対象: 要件 5.2**

  - [x] 2.10 単体テスト: CameraServiceの各メソッド
    - カメラ初期化のテスト
    - リソース解放のテスト
    - エラーハンドリングのテスト
    - _要件: 1.2, 1.3, 1.4, 4.1, 4.2, 5.1, 5.2, 5.3_

- [x] 3. チェックポイント - すべてのテストが通ることを確認
  - すべてのテストが通ることを確認し、問題があればユーザーに質問する

- [x] 4. CameraViewウィジェットの実装
  - [x] 4.1 CameraViewウィジェットを作成
    - HtmlElementViewを使用してVideoElementを埋め込む
    - platformViewRegistryでVideoElementを登録
    - _要件: 2.1_

  - [x] 4.2 鏡像変換の適用
    - VideoElementにscaleX(-1)のCSS transformを適用
    - _要件: 2.1_

  - [x] 4.3 プロパティテスト: 鏡像変換の適用
    - **プロパティ 2: 鏡像変換の適用**
    - **検証対象: 要件 2.1**

  - [x] 4.4 アスペクト比の保持機能を実装
    - AspectRatioウィジェットを使用して元のアスペクト比を維持
    - _要件: 2.2_

  - [x] 4.5 プロパティテスト: アスペクト比の保持
    - **プロパティ 3: アスペクト比の保持**
    - **検証対象: 要件 2.2**

  - [x] 4.6 ウィジェットテスト: CameraViewの表示
    - VideoElementが正しく埋め込まれることを確認
    - 変換が適用されていることを確認
    - _要件: 2.1, 2.2_

- [x] 5. ErrorViewウィジェットの実装
  - [x] 5.1 ErrorViewウィジェットを作成
    - エラータイプに応じた適切なメッセージを表示
    - 再試行ボタンを提供（該当する場合）
    - _要件: 1.3, 1.4, 5.1_

  - [x] 5.2 ウィジェットテスト: ErrorViewの表示
    - 各エラータイプで適切なメッセージが表示されることを確認
    - _要件: 1.3, 1.4, 5.1_

- [x] 6. MirrorScreenの実装
  - [x] 6.1 MirrorScreenウィジェットを作成
    - StatefulWidgetとして実装
    - CameraServiceのインスタンスを管理
    - CameraStateに基づいてUIを切り替え
    - _要件: 1.1, 1.2_

  - [x] 6.2 ライフサイクル管理を実装
    - initStateでカメラを初期化
    - disposeでリソースを解放
    - _要件: 4.1, 4.2_

  - [x] 6.3 レスポンシブレイアウトを実装
    - LayoutBuilderを使用して画面サイズに応じたレイアウトを構築
    - Centerウィジェットで映像を中央配置
    - _要件: 3.1, 3.2, 3.3_

  - [x] 6.4 プロパティテスト: レスポンシブレイアウトの維持
    - **プロパティ 4: レスポンシブレイアウトの維持**
    - **検証対象: 要件 3.1, 3.2, 3.3**

  - [x] 6.5 ウィジェットテスト: MirrorScreenの状態遷移
    - 初期状態からアクティブ状態への遷移をテスト
    - エラー状態の表示をテスト
    - _要件: 1.1, 1.2, 1.3, 1.4_

- [x] 7. main.dartの更新
  - [x] 7.1 main.dartを更新してMirrorScreenを表示
    - MyAppウィジェットをシンプルなMaterialAppに変更
    - MirrorScreenをホーム画面として設定
    - アプリのタイトルとテーマを設定
    - _要件: 1.1_

- [x] 8. ブラウザ互換性チェックの実装
  - [x] 8.1 ブラウザAPIサポートチェック機能を追加
    - navigator.mediaDevicesの存在確認
    - サポートされていない場合のエラー表示
    - _要件: 7.2_

  - [x] 8.2 単体テスト: ブラウザ互換性チェック
    - APIサポートチェックのロジックをテスト
    - _要件: 7.2_

- [x] 9. 最終チェックポイント - すべてのテストが通ることを確認
  - すべてのテストが通ることを確認し、問題があればユーザーに質問する
